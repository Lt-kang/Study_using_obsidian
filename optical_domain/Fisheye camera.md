# Fisheye camera(어안렌즈)란?
- 약 180도 전후의 매우 넓은 시야각을 갖는 특수 광학 렌즈
- 기상 관측/천문 촬영 등의 전문 용도로 개발되었으나 현재는 로봇/자율주행 분야에도 다양하게 활용됨
- 일반 광각과 달리 **직선이 휘어보이는 독특한 왜곡이 발생**함
	- 왜곡(distortion)이 결함이 아닌 **기능**으로써 사용됨


# Fisheye camera 특징
## 초광각 화각
- 초광각 렌즈 사용으로 인해 160~200도 이상의 넓은 시야각 확보
- 넓은 시야를 한번에 확보 가능
- 넓은 시야로 인해 공간 환경 인식에 강력함
	- 시야에 왜곡이 있더라도 object 자체를 놓칠 염려는 없음

## 고의적인 기하 왜곡(distortion)
- 직선이 프레임 중심에서 멀어질수록 바깥쪽으로 크게 휘어짐.
- 자율주행에서 사용할 경우 이러한 왜곡을 수학적으로 보정하여 주변 지도 생성


# Fisheye Projection 종류

## Equidistant Projection(등거리 투영)
$$r = f * \theta$$
- 물체가 렌즈 중심과 이루는 방향각 $\theta$ 에 비례하여 화면 반지름 $r$이 증가함
- 로봇/자율주행 분야에서 쓰는 fisheye 대표적 모델
- **각도 정확도가 높아 SLAM, 시야각 기반 센싱에서 유리**


## Equisolid Angle Projection(등면적 투영)
$$r = 2 * f * sin(\frac{\theta}{2})$$
- 동일한 입사광 고체각(solid angle)을 동일 면적으로 표현
- 사진 분야에서 많이 사용되나, 자율주행에서도 일부 적용
- **광량 균형이 좋아 밝기 특성이 고르게 유지**

## Orthographic Projection(정사영)
$$r = f * sin(\theta)$$
- 구면을 맞닿는 평면에 투영
- 화면 주변부 왜곡이 비교적 적음
- FOV(Field of View, 시야각)가 매우 넓을 때 센싱 목적에선 덜 선호

## Stereographic Projection(정적도 투영)
$$r = 2f*tan(\frac{\theta}{2})$$
- 직선이 가능한 한 곡선처럼 보이지 않도록 설계
- 시각적으로 보기 좋지만, 자율주행에서는 보정 비용 때문에 흔하지 않음

## 자율주행 분야에서 주로 사용하는 방식
- Equidistant
- Equisolid
기하학적 해석과 보정이 간단하고, 알고리즘 처리의 안정성이 높음.



# projection 공식에 대한 직관적인 이해
- $r = f * \theta$
- `r`: 이미지 반지름(pixel 수)
- `f`: 픽셀로 환산된 시야각 스케일
	- 정확한 정의는 `렌즈에서 이미지까지의 거리(초점거리)`
	- 빛이 들어오는 각도 $\theta$ 를 이미지에서 몇 픽셀로 표현할지에 대한 변환 비율(scale factor)
- $\theta$ : 카메라 최대 각도(단위: rad)

## `f`의 변화에 따른 화각 변화 양상
- 전제조건
	- ${r}_{max} = f * {\theta}_{max}$
		- ${r}_{max}$: 이미지 반지름
		- ${\theta}_{max}$: 한쪽 방향으로 볼 수 있는 최대 각도
	- $r = f*\theta$
	- FOV(화각) = $2{\theta}_{max}$
		- ex)
		  왼쪽 최대 각도 90도
		  오른쪽 최대 각도 90도
		  => 화각 180도

`f`가 증가하면 $\theta$는 줄어든다.
이는 `f`가 크면 이미


# Fisheye와 왜곡에 대해서
- 빛이 센서에 도달하는 단계에서부터 이미 물리적으로 왜곡되어 있음.
	- 어안 렌즈의 곡면을 통과하는 순간부터 굴절됨.
	- 센서에 곡선 형태로 투영됨.
- 렌즈 자체에서 광학적으로 왜곡된 이미지가 만들어짐.

